// import 'package:flutter/material.dart';
// import 'package:hymn/providers/history.dart';
// import 'package:hymn/screens/favorite_pdf.dart';
// import 'package:hymn/themes/theme_provider.dart';

// import 'package:provider/provider.dart';

// class History extends StatefulWidget {
//   const History({super.key});

//   @override
//   State<History> createState() => _HistoryState();
// }

// class _HistoryState extends State<History> {
//   final indexing = [
//     "၁",
//     "၂",
//     "၃",
//     "၄",
//     "၅",
//     "၆",
//     "၇",
//     "၈",
//     "၉",
//     "၁၀",
//     "၁၁",
//     "၁၂",
//     "၁၃",
//     "၁၄",
//     "၁၅",
//     "၁၆",
//     "၁၇",
//     "၁၈",
//     "၁၉",
//     "၂၀",
//     "၂၁",
//     "၂၂",
//     "၂၃",
//     "၂၄",
//     "၂၅",
//     "၂၆",
//     "၂၇",
//     "၂၈",
//     "၂၉",
//     "၃၀",
//     "၃၁",
//     "၃၂",
//     "၃၃",
//     "၃၄",
//     "၃၅",
//     "၃၆",
//     "၃၇",
//     "၃၈",
//     "၃၉",
//     "၄၀",
//     "၄၁",
//     "၄၂",
//     "၄၃",
//     "၄၄",
//     "၄၅",
//     "၄၆",
//     "၄၇",
//     "၄၈",
//     "၄၉",
//     "၅၀",
//     "၅၁",
//     "၅၂",
//     "၅၃",
//     "၅၄",
//     "၅၅",
//     "၅၆",
//     "၅၇",
//     "၅၈",
//     "၅၉",
//     "၆၀",
//     "၆၁",
//     "၆၂",
//     "၆၃",
//     "၆၄",
//     "၆၅",
//     "၆၆",
//     "၆၇",
//     "၆၈",
//     "၆၉",
//     "၇၀",
//     "၇၁",
//     "၇၂",
//     "၇၃",
//     "၇၄",
//     "၇၅",
//     "၇၆",
//     "၇၇",
//     "၇၈",
//     "၇၉",
//     "၈၀",
//     "၈၁",
//     "၈၂",
//     "၈၃",
//     "၈၄",
//     "၈၅",
//     "၈၆",
//     "၈၇",
//     "၈၈",
//     "၈၉",
//     "၉၀",
//     "၉၁",
//     "၉၂",
//     "၉၃",
//     "၉၄",
//     "၉၅",
//     "၉၆",
//     "၉၇",
//     "၉၈",
//     "၉၉",
//     "၁၀၀",
//     "၁၀၁",
//     "၁၀၂",
//     "၁၀၃",
//     "၁၀၄",
//     "၁၀၅",
//     "၁၀၆",
//     "၁၀၇",
//     "၁၀၈",
//     "၁၀၉",
//     "၁၁၀",
//     "၁၁၁",
//     "၁၁၂",
//     "၁၁၃",
//     "၁၁၄",
//     "၁၁၅",
//     "၁၁၆",
//     "၁၁၇",
//     "၁၁၈",
//     "၁၁၉",
//     "၁၂၀",
//     "၁၂၁",
//     "၁၂၂",
//     "၁၂၃",
//     "၁၂၄",
//     "၁၂၅",
//     "၁၂၆",
//     "၁၂၇",
//     "၁၂၈",
//     "၁၂၉",
//     "၁၃၀",
//     "၁၃၁",
//     "၁၃၂",
//     "၁၃၃",
//     "၁၃၄",
//     "၁၃၅",
//     "၁၃၆",
//     "၁၃၇",
//     "၁၃၈",
//     "၁၃၉",
//     "၁၄၀",
//     "၁၄၁",
//     "၁၄၂",
//     "၁၄၃",
//     "၁၄၄",
//     "၁၄၅",
//     "၁၄၆",
//     "၁၄၇",
//     "၁၄၈",
//     "၁၄၉",
//     "၁၅၀",
//     "၁၅၁",
//     "၁၅၂",
//     "၁၅၃",
//     "၁၅၄",
//     "၁၅၅",
//     "၁၅၆",
//     "၁၅၇",
//     "၁၅၈",
//     "၁၅၉",
//     "၁၆၀",
//     "၁၆၁",
//     "၁၆၂",
//     "၁၆၃",
//     "၁၆၄",
//     "၁၆၅",
//     "၁၆၆",
//     "၁၆၇",
//     "၁၆၈",
//     "၁၆၉",
//     "၁၇၀",
//     "၁၇၁",
//     "၁၇၂",
//     "၁၇၃",
//     "၁၇၄",
//     "၁၇၅",
//     "၁၇၆",
//     "၁၇၇",
//     "၁၇၈",
//     "၁၇၉",
//     "၁၈၀",
//     "၁၈၁",
//     "၁၈၂",
//     "၁၈၃",
//     "၁၈၄",
//     "၁၈၅",
//     "၁၈၆",
//     "၁၈၇",
//     "၁၈၈",
//     "၁၈၉",
//     "၁၉၀",
//     "၁၉၁",
//     "၁၉၂",
//     "၁၉၃",
//     "၁၉၄",
//     "၁၉၅",
//     "၁၉၆",
//     "၁၉၇",
//     "၁၉၈",
//     "၁၉၉",
//     "၂၀၀",
//     "၂၀၁",
//     "၂၀၂",
//     "၂၀၃",
//     "၂၀၄",
//     "၂၀၅",
//     "၂၀၆",
//     "၂၀၇",
//     "၂၀၈",
//     "၂၀၉",
//     "၂၁၀",
//     "၂၁၁",
//     "၂၁၂",
//     "၂၁၃",
//     "၂၁၄",
//     "၂၁၅",
//     "၂၁၆",
//     "၂၁၇",
//     "၂၁၈",
//     "၂၁၉",
//     "၂၂၀",
//     "၂၂၁",
//     "၂၂၂",
//     "၂၂၃",
//     "၂၂၄",
//     "၂၂၅",
//     "၂၂၆",
//     "၂၂၇",
//     "၂၂၈",
//     "၂၂၉",
//     "၂၃၀",
//     "၂၃၁",
//     "၂၃၂",
//     "၂၃၃",
//     "၂၃၄",
//     "၂၃၅",
//     "၂၃၆",
//     "၂၃၇",
//     "၂၃၈",
//     "၂၃၉",
//     "၂၄၀",
//     "၂၄၁",
//     "၂၄၂",
//     "၂၄၃",
//     "၂၄၄",
//     "၂၄၅",
//     "၂၄၆",
//     "၂၄၇",
//     "၂၄၈",
//     "၂၄၉",
//     "၂၅၀",
//     "၂၅၁",
//     "၂၅၂",
//     "၂၅၃",
//     "၂၅၄",
//     "၂၅၅",
//     "၂၅၆",
//     "၂၅၇",
//     "၂၅၈",
//     "၂၅၉",
//     "၂၆၀",
//     "၂၆၁",
//     "၂၆၂",
//     "၂၆၃",
//     "၂၆၄",
//     "၂၆၅",
//     "၂၆၆",
//     "၂၆၇",
//     "၂၆၈",
//     "၂၆၉",
//     "၂၇၀",
//     "၂၇၁",
//     "၂၇၂",
//     "၂၇၃",
//     "၂၇၄",
//     "၂၇၅",
//     "၂၇၆",
//     "၂၇၇",
//     "၂၇၈",
//     "၂၇၉",
//     "၂၈၀",
//     "၂၈၁",
//     "၂၈၂",
//     "၂၈၃",
//     "၂၈၄",
//     "၂၈၅",
//     "၂၈၆",
//     "၂၈၇",
//     "၂၈၈",
//     "၂၈၉",
//     "၂၉၀",
//     "၂၉၁",
//     "၂၉၂",
//     "၂၉၃",
//     "၂၉၄",
//     "၂၉၅",
//     "၂၉၆",
//     "၂၉၇",
//     "၂၉၈",
//     "၂၉၉",
//     "၃၀၀",
//     "၃၀၁",
//     "၃၀၂",
//     "၃၀၃",
//     "၃၀၄",
//     "၃၀၅",
//     "၃၀၆",
//   ];

//   @override
//   Widget build(BuildContext context) {
//     final favoriteProvider = Provider.of<HistoryProvider>(context);
//     final favoriteHymns =
//         favoriteProvider.getAllHistoryHymns().entries.toList();

//     return Scaffold(
//       backgroundColor:
//           Provider.of<ThemeProvider>(context).themeData.colorScheme.secondary,
//       appBar: AppBar(
//         title: Text(
//           'History',
//           style: TextStyle(fontSize: 16),
//         ),
//         centerTitle: true,
//       ),
//       body: favoriteHymns.isEmpty
//           ? Center(
//               child: Text(
//                 'History မရှိသေးပါ!',
//                 style: TextStyle(
//                     color: Provider.of<ThemeProvider>(context)
//                         .themeData
//                         .colorScheme
//                         .inversePrimary),
//               ),
//             )
//           : ListView.builder(
//               itemCount: favoriteHymns.length,
//               itemBuilder: (context, index) {
//                 final hymnEntry = favoriteHymns[index];
//                 return _buildPDFViewer(hymnEntry.key, hymnEntry.value,
//                     favoriteProvider, index + 1);
//               },
//             ),
//     );
//   }

//   Widget _buildPDFViewer(
//       String key, String hymn, HistoryProvider favoriteProvider, int index) {
//     return InkWell(
//       onTap: () async {
//         int StartIndex = key.indexOf('(') + 1;
//         int endIndex = key.indexOf(')');
//         String File_index = key.substring(StartIndex, endIndex);
//         print(key.contains('ဓမ္မသီချင်း'));
//         print(
//             'asset/images/MH${(indexing.indexOf(File_index) + 1).toString().padLeft(3, '0')}-1.jpg');
//         Navigator.push(
//           context,
//           MaterialPageRoute(
//               builder: (context) => key.contains('ဓမ္မသီချင်း')
//                   ? MyFavoritePdfViewer(
//                       pdfPath:
//                           'asset/images/MH${(indexing.indexOf(File_index) + 1).toString().padLeft(3, '0')}-1.jpg',
//                       number: key,
//                       hymn: hymn,
//                       type: "Favorite",
//                       index: index,
//                     )
//                   : MyFavoritePdfViewer(
//                       pdfPath:
//                           'asset/images/RP${(indexing.indexOf(File_index) + 1).toString().padLeft(2, '0')}-1.jpg',
//                       number: key,
//                       hymn: hymn,
//                       type: "Favorite",
//                       index: index,
//                     )),
//         );
//       },
//       child: Card(
//         child: ListTile(
//           leading: Text(key),
//           title: Text(hymn),
          
//         ),
//       ),
//     );
//   }
// }

import 'package:flutter/material.dart';
import 'package:hymn/providers/history.dart';
import 'package:hymn/screens/favorite_pdf.dart';
import 'package:hymn/themes/theme_provider.dart';
import 'package:provider/provider.dart';

class History extends StatefulWidget {
  const History({super.key});

  @override
  State<History> createState() => _HistoryState();
}

class _HistoryState extends State<History> {
  final indexing = [
      "၁",
    "၂",
    "၃",
    "၄",
    "၅",
    "၆",
    "၇",
    "၈",
    "၉",
    "၁၀",
    "၁၁",
    "၁၂",
    "၁၃",
    "၁၄",
    "၁၅",
    "၁၆",
    "၁၇",
    "၁၈",
    "၁၉",
    "၂၀",
    "၂၁",
    "၂၂",
    "၂၃",
    "၂၄",
    "၂၅",
    "၂၆",
    "၂၇",
    "၂၈",
    "၂၉",
    "၃၀",
    "၃၁",
    "၃၂",
    "၃၃",
    "၃၄",
    "၃၅",
    "၃၆",
    "၃၇",
    "၃၈",
    "၃၉",
    "၄၀",
    "၄၁",
    "၄၂",
    "၄၃",
    "၄၄",
    "၄၅",
    "၄၆",
    "၄၇",
    "၄၈",
    "၄၉",
    "၅၀",
    "၅၁",
    "၅၂",
    "၅၃",
    "၅၄",
    "၅၅",
    "၅၆",
    "၅၇",
    "၅၈",
    "၅၉",
    "၆၀",
    "၆၁",
    "၆၂",
    "၆၃",
    "၆၄",
    "၆၅",
    "၆၆",
    "၆၇",
    "၆၈",
    "၆၉",
    "၇၀",
    "၇၁",
    "၇၂",
    "၇၃",
    "၇၄",
    "၇၅",
    "၇၆",
    "၇၇",
    "၇၈",
    "၇၉",
    "၈၀",
    "၈၁",
    "၈၂",
    "၈၃",
    "၈၄",
    "၈၅",
    "၈၆",
    "၈၇",
    "၈၈",
    "၈၉",
    "၉၀",
    "၉၁",
    "၉၂",
    "၉၃",
    "၉၄",
    "၉၅",
    "၉၆",
    "၉၇",
    "၉၈",
    "၉၉",
    "၁၀၀",
    "၁၀၁",
    "၁၀၂",
    "၁၀၃",
    "၁၀၄",
    "၁၀၅",
    "၁၀၆",
    "၁၀၇",
    "၁၀၈",
    "၁၀၉",
    "၁၁၀",
    "၁၁၁",
    "၁၁၂",
    "၁၁၃",
    "၁၁၄",
    "၁၁၅",
    "၁၁၆",
    "၁၁၇",
    "၁၁၈",
    "၁၁၉",
    "၁၂၀",
    "၁၂၁",
    "၁၂၂",
    "၁၂၃",
    "၁၂၄",
    "၁၂၅",
    "၁၂၆",
    "၁၂၇",
    "၁၂၈",
    "၁၂၉",
    "၁၃၀",
    "၁၃၁",
    "၁၃၂",
    "၁၃၃",
    "၁၃၄",
    "၁၃၅",
    "၁၃၆",
    "၁၃၇",
    "၁၃၈",
    "၁၃၉",
    "၁၄၀",
    "၁၄၁",
    "၁၄၂",
    "၁၄၃",
    "၁၄၄",
    "၁၄၅",
    "၁၄၆",
    "၁၄၇",
    "၁၄၈",
    "၁၄၉",
    "၁၅၀",
    "၁၅၁",
    "၁၅၂",
    "၁၅၃",
    "၁၅၄",
    "၁၅၅",
    "၁၅၆",
    "၁၅၇",
    "၁၅၈",
    "၁၅၉",
    "၁၆၀",
    "၁၆၁",
    "၁၆၂",
    "၁၆၃",
    "၁၆၄",
    "၁၆၅",
    "၁၆၆",
    "၁၆၇",
    "၁၆၈",
    "၁၆၉",
    "၁၇၀",
    "၁၇၁",
    "၁၇၂",
    "၁၇၃",
    "၁၇၄",
    "၁၇၅",
    "၁၇၆",
    "၁၇၇",
    "၁၇၈",
    "၁၇၉",
    "၁၈၀",
    "၁၈၁",
    "၁၈၂",
    "၁၈၃",
    "၁၈၄",
    "၁၈၅",
    "၁၈၆",
    "၁၈၇",
    "၁၈၈",
    "၁၈၉",
    "၁၉၀",
    "၁၉၁",
    "၁၉၂",
    "၁၉၃",
    "၁၉၄",
    "၁၉၅",
    "၁၉၆",
    "၁၉၇",
    "၁၉၈",
    "၁၉၉",
    "၂၀၀",
    "၂၀၁",
    "၂၀၂",
    "၂၀၃",
    "၂၀၄",
    "၂၀၅",
    "၂၀၆",
    "၂၀၇",
    "၂၀၈",
    "၂၀၉",
    "၂၁၀",
    "၂၁၁",
    "၂၁၂",
    "၂၁၃",
    "၂၁၄",
    "၂၁၅",
    "၂၁၆",
    "၂၁၇",
    "၂၁၈",
    "၂၁၉",
    "၂၂၀",
    "၂၂၁",
    "၂၂၂",
    "၂၂၃",
    "၂၂၄",
    "၂၂၅",
    "၂၂၆",
    "၂၂၇",
    "၂၂၈",
    "၂၂၉",
    "၂၃၀",
    "၂၃၁",
    "၂၃၂",
    "၂၃၃",
    "၂၃၄",
    "၂၃၅",
    "၂၃၆",
    "၂၃၇",
    "၂၃၈",
    "၂၃၉",
    "၂၄၀",
    "၂၄၁",
    "၂၄၂",
    "၂၄၃",
    "၂၄၄",
    "၂၄၅",
    "၂၄၆",
    "၂၄၇",
    "၂၄၈",
    "၂၄၉",
    "၂၅၀",
    "၂၅၁",
    "၂၅၂",
    "၂၅၃",
    "၂၅၄",
    "၂၅၅",
    "၂၅၆",
    "၂၅၇",
    "၂၅၈",
    "၂၅၉",
    "၂၆၀",
    "၂၆၁",
    "၂၆၂",
    "၂၆၃",
    "၂၆၄",
    "၂၆၅",
    "၂၆၆",
    "၂၆၇",
    "၂၆၈",
    "၂၆၉",
    "၂၇၀",
    "၂၇၁",
    "၂၇၂",
    "၂၇၃",
    "၂၇၄",
    "၂၇၅",
    "၂၇၆",
    "၂၇၇",
    "၂၇၈",
    "၂၇၉",
    "၂၈၀",
    "၂၈၁",
    "၂၈၂",
    "၂၈၃",
    "၂၈၄",
    "၂၈၅",
    "၂၈၆",
    "၂၈၇",
    "၂၈၈",
    "၂၈၉",
    "၂၉၀",
    "၂၉၁",
    "၂၉၂",
    "၂၉၃",
    "၂၉၄",
    "၂၉၅",
    "၂၉၆",
    "၂၉၇",
    "၂၉၈",
    "၂၉၉",
    "၃၀၀",
    "၃၀၁",
    "၃၀၂",
    "၃၀၃",
    "၃၀၄",
    "၃၀၅",
    "၃၀၆",
  ];

  @override
  Widget build(BuildContext context) {
    final historyProvider = Provider.of<HistoryProvider>(context);
    final historyHymns = historyProvider.getAllHistoryHymns().entries.toList().reversed.toList();

    return Scaffold(
      backgroundColor:
          Provider.of<ThemeProvider>(context).themeData.colorScheme.secondary,
      appBar: AppBar(
        title: Text(
          'History',
          style: TextStyle(fontSize: 16),
        ),
        centerTitle: true,
      ),
      body: historyHymns.isEmpty
          ? Center(
              child: Text(
                'History မရှိသေးပါ!',
                style: TextStyle(
                    color: Provider.of<ThemeProvider>(context)
                        .themeData
                        .colorScheme
                        .inversePrimary),
              ),
            )
          : Padding(
            padding: const EdgeInsets.symmetric(horizontal: 8),
            child: ListView.builder(
                itemCount: historyHymns.length,
                itemBuilder: (context, index) {
                  final hymnEntry = historyHymns[index];
                  final hymnDetails = hymnEntry.value;
                  return _buildPDFViewer(
                      hymnEntry.key, hymnDetails['hymn']?? "", hymnDetails['date']??"", historyProvider, index + 1);
                },
              ),
          ),
    );
  }

  Widget _buildPDFViewer(String key, String hymn, String date, HistoryProvider historyProvider, int index) {
    return InkWell(
      onTap: () async {
        int startIndex = key.indexOf('(') + 1;
        int endIndex = key.indexOf(')');
        String fileIndex = key.substring(startIndex, endIndex);
        print(key.contains('ဓမ္မသီချင်း'));
        print(
            'asset/images/MH${(indexing.indexOf(fileIndex) + 1).toString().padLeft(3, '0')}-1.jpg');
        Navigator.push(
          context,
          MaterialPageRoute(
              builder: (context) => key.contains('ဓမ္မသီချင်း')
                  ? MyFavoritePdfViewer(
                      pdfPath:
                          'asset/images/MH${(indexing.indexOf(fileIndex) + 1).toString().padLeft(3, '0')}-1.jpg',
                      number: key,
                      hymn: hymn,
                      type: "Favorite",
                      index: index,
                    )
                  : MyFavoritePdfViewer(
                      pdfPath:
                          'asset/images/RP${(indexing.indexOf(fileIndex) + 1).toString().padLeft(2, '0')}-1.jpg',
                      number: key,
                      hymn: hymn,
                      type: "Favorite",
                      index: index,
                    )),
        );
      },
      child: Card(
        child: ListTile(
          leading: Text(key),
          title: Text(hymn,style: TextStyle(fontSize: 14),),
          trailing: Text(date,style: TextStyle(fontSize: 11),), // Add the date to the list item
        ),
      ),
    );
  }
}
